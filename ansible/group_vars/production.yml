---
# ========================================
# Variables environnement PRODUCTION
# ========================================

deploy_environment: production

# Features conditionnelles
system_enable_gpu: true
proxy_enable_letsencrypt: true
storage_enable_zfs_snapshots: true

# Domaine de base
base_domain: "louisvolat.fr"
litopia: "litopia.fr"

# Domaines des services
service_domains:
  traefik: "traefik.{{ base_domain }}"
  immich: "photos.{{ base_domain }}"
  jellyfin: "jellyfin.{{ base_domain }}"
  nextcloud: "cloud.{{ base_domain }}"
  grafana: "monitoring.{{ base_domain }}"

# Racines physiques (Production)
drive_nvme_path: "/opt/epicea"
drive_ssd_path: "/mnt/ssd_tank"
drive_nfs_root: "/mnt/nas"

# Configuration NFS (Ubiquiti NAS Pro)
nfs_server: "192.168.1.50"
nfs_mounts:
  - src: "{{ nfs_server }}:/volume1/media"
    path: "{{ drive_nfs_root }}/media"
    opts: "rw,hard,intr,nfsvers=4.1"
  - src: "{{ nfs_server }}:/volume1/photos"
    path: "{{ drive_nfs_root }}/photos"
    opts: "rw,hard,intr,nfsvers=4.1"
  - src: "{{ nfs_server }}:/volume1/cloud"
    path: "{{ drive_nfs_root }}/cloud"
    opts: "rw,hard,intr,nfsvers=4.1"

# NFS Backup (Ubiquiti NAS Quad)
nfs_backup_server: "192.168.1.51"
nfs_backup_mount:
  src: "{{ nfs_backup_server }}:/volume1/backups"
  path: "{{ drive_nfs_root }}/backups"
  opts: "rw,hard,intr,nfsvers=4.1"

# Services activés
enabled_services:
  - traefik
  - redis
  - immich
  - jellyfin
  - nextcloud
  - monitoring
  - games  # AMP

# Les chemins sont maintenant définis dans common.yml via l'objet storage

# Configuration ZFS (SSD local 1To)
zfs_pool_name: "tank"
zfs_datasets:
  - name: "{{ zfs_pool_name }}/docker"
    mountpoint: "/var/lib/docker"
  - name: "{{ zfs_pool_name }}/postgres"
    mountpoint: "{{ storage.databases.immich }}"
  - name: "{{ zfs_pool_name }}/redis"
    mountpoint: "{{ storage.databases.redis }}"

# Configuration GPU (RTX 5060 LP)
gpu_driver_version: "550"  # Version driver NVIDIA (à adapter)
gpu_docker_runtime: true
gpu_monitoring: true

# Configuration Traefik (production)
traefik_acme_enabled: true
traefik_acme_email: "admin@{{ base_domain }}"  # À MODIFIER
traefik_acme_storage: "{{ config_path }}/traefik/acme.json"
traefik_dashboard_enabled: true
traefik_log_level: "INFO"

# Configuration Docker
docker_daemon_log_max_size: "50m"
docker_daemon_log_max_file: "5"

# Monitoring
monitoring_prometheus_retention: "90d"
monitoring_loki_retention: "30d"
monitoring_grafana_root_url: "https://monitoring.louisvolat.fr"
monitoring_grafana_install_plugins: true
monitoring_prometheus_cadvisor_enabled: true
monitoring_prometheus_node_exporter_enabled: true

# Backup
backup_system_enabled: true
backup_system_retention_days: 30
backup_system_schedule: "0 3 * * *"  # Tous les jours à 3h du matin

# Notifications (Discord/Telegram)
# discord_webhook_url: "{{ vault_discord_webhook }}"  # Dans vault.yml
# telegram_bot_token: "{{ vault_telegram_token }}"    # Dans vault.yml
# telegram_chat_id: "{{ vault_telegram_chat_id }}"    # Dans vault.yml

# Fail2ban
fail2ban_enabled: true
fail2ban_bantime: "1h"
fail2ban_maxretry: 5

# UFW Rules additionnelles (production)
ufw_additional_rules:
  - { rule: 'allow', port: '8080', proto: 'tcp', comment: 'Traefik dashboard' }
  - { rule: 'allow', port: '9090', proto: 'tcp', comment: 'Prometheus (internal)' }
  - { rule: 'allow', from: '192.168.1.0/24', comment: 'LAN local' }
